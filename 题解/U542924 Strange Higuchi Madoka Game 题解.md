显然有二分答案

考虑对取出的环，若有位置 $i$ 使得其满足 $a_{i-1}\le a_i$ 且 $a_{i+1}\le a_i$ 或 $a_{i-1}\ge a_i$ 且 $a_{i+1}\ge a_i$，则我们称位置 $i$ 为 “谷”

那么显然的，由于这是一个环，所以这其中必然会存在至少一个谷，而且由于删掉一个谷中间的元素最大值一定不劣，所以环上元素的较多的方案一定能够转化为元素小于其的方案

故考虑枚举第一个选择的元素，然后进行dp，设$f_{i}$ 表示当前最后一个选择的元素是 $i$，此时所有方案中环的大小最大值，可以离散化+线段树优化

我们就得到了 $O(n^2\log n\log m)$ 的做法，其中 $m$ 表示值域

不妨断环为链，并复制一份原序列接到后方，对其扫描线

考虑设 $f_{i,j}$ 表示左右端点分别为 $i,j$ 的最大长度，那么有转移

$$f_{i,j}=\max_{a_j-mid \le a_k\le a_j+mid}f_{i,k}$$
对于两个决策点 $k_1<k_2$ ，若有 $a_{k_2}-mid \le a_{k_1} \le a_{k_2}+mid$ ，则此时一定有 $f_{i,k_2}>f_{i,k_1}$ ($k_2$ 可以从 $k_1$ 直接继承而来)，发现这样的决策点 $k$ 最多只会有两个，所以直接暴力转移即可



