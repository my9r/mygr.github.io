从本质开始考虑

当 $n=2$ 时，当且仅当 $a_1\le a_2 \vee a_1=a_2+1$ 时才合法

手玩几组发现符合条件的 $A$ 一定可以被分解为若干段，使得其满足每一段都由一个定值 $d$ 与 $d-1$ 构成，且前一段的最大值一定小于后一段的最小值

此时我们造出的若干段之间相互独立，也就可以分别计算再乘起来了

将上面的条件总结一下，其实也就是

$$\forall p_j=\max_{i=1}^{j-1}a_i ,p_{j-1}\le a_j+1$$
此时就可以大力 dp 了

-----------

考虑反过来想，假设我们得到了序列 $p$，我们能够对应多少个不同的 $a$ ?

假设序列长度为 $n$ ，总共被分为了 $m$ 段，那么方案数显然为 $2^{n-m}$

假设一段子段长度为 $n$，左端的值为 $x$ ，右端的值为 $y$ ，那么它的方案数为

$$F(n,x,y)=\sum_{i=0}^{n}C_{n}^{i}C_{y-x+1}^{i}2^{n-i}$$
然后把所有 $c_i$ 分成的段的方案数乘起来就好

但是这样转移是有问题的，因为我们只知道左端的点为 $x$ ，但是事实上，前面这段的最大值可能为 $x+1$ ，此时的方案数就截然不同了

所以考虑在此基础上进行dp，不妨设 $f_{i,0/1}$ 表示 $c_i$ 处有 $p_{c_i}=v_i+0/1$ 的方案数，那么有转移

$$f_{i,0}=f_{i-1,0} \times F(c_i-c_{i-1}-1,v_{i-1},v_{i}-1)+f_{i-1,1}\times F(c_i-c_{i-1}-1,v_{i-1}+1,v_{i})$$
$$f_{i,1}=f_{i-1,0} \times F(c_i-c_{i-1}-1,v_{i},v_{i-1})+f_{i-1,1}\times F(c_i-c_{i-1}-1,v_{i}+1,v_{i-1})$$






