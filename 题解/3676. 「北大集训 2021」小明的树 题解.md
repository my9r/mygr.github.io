[传送锚点](https://loj.ac/p/3676)

考虑转化

首先我们有对于一棵完美的树，首先它必须满足其由若干个叶子子树构成，也就是说这些点的所有儿子节点都被染色，也就是说需要满足 
$$联通块数量-只有一端被染色的边数=0$$
而我们又知道 [[树上问题#^7e5c4a | 联通块数量=被点亮的点数-两段都被染色的边数]] ，所有整理就有
$$被点亮的点数=两端中有一端被染色的边数$$
发现这样子每个点的影响就被拆分到相邻的点对中去了，自然在修改树的结构时也只有相邻点对会产生影响

我们考虑用 $f_{i}$ 表示 $第i个点加入时，两端中有一端被染色的边数-i$ ，显然是可以用数据结构维护的，且恒大于等于 $0$ 

再额外记录一个 $g_i$ 表示 $i-第i个点加入时，都被染色的边数$ ，

那么答案就是 $\sum [f_i=0]g_i$ 

问题变成一个区间加减，问对应 $0$ 位置的和，因为恒为正整数，所以直接记录最小值以及最小值对应位置的和即可

然后就做完了？

