[原视频链接](https://www.bilibili.com/video/av12131743/?vd_source=9d55d486d4e600a9cac6498e5fc673ca)

先考虑这么一个[问题](https://www.luogu.com.cn/problem/P2508)：对于一个半径为 $r$ 的圆，他会经过多少个整数格点？

也就是说 $x^2+y^2=r^2$ 的整数解的个数

不妨将一组解 $(x,y)$ 视作虚数 $x+yi$ (称为高斯整数) ，那么条件就转化为

$$(x+yi)(x-yi)=r^2$$
我们不妨思考下对于一个整数 $R$，如何去分解为上述形式

显然具有积性，所以启发我们从 "$R$ 为质因数" 的角度去思考

所以对于一个合数，我们先将其进行质因数分解，得到若干质因子，然后对每个质因子进行分解得到他们的高斯整数，所以最终就能够表示为若干高斯整数的乘积，最终解的数量即为将这些高斯整数分为两组，使得两组的乘积共轭的方案数

这怎么求呢？先将原 $(x+yi)$ 的部分全部归作一组，那么最终的结果一定共轭

根据共轭相关的知识，在两组中交换本就共轭的数对，最终的乘积一定也还是共轭

所以最终的方案数即为

$$\prod_{p \in pri}(c_p +1)$$
其中 $pri$ 表示所有高斯整数的集合，$c_p$ 表示 $p$ 对应的数量

根据费马平方和定理可知，一个奇质数 $R$ 能够被分解为 $x^2+y^2$ ，当且仅当 $R \equiv 1 \pmod{4}$ ，且解法唯一，若不满足上述条件，则意味着其不能够分解为两个高斯整数，则这个数不能够平均的分配到两个集合中，故无解(除非其次数为偶数)

又因为复数可以通过乘上 $-1,i,-i$ 来构造出相同的复数类型，所以最终答案数需要 $\times 4$

