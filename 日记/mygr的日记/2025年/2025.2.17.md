## 模拟赛

### T1

我们不妨钦定最后一次删除时的联通块是哪个

可以通过找他的代表元来确定，也就是联通块的根节点

问题就变成了枚举根节点，问有多少种方式使得其最后一次删除

发现这样子就好看多了，具体的，我们可以将删除一个点集转化为删除一条边，同时删去其不存在根节点的那一部分

考虑设 $f_{i,j}$ 表示当前点在 $i$ 总共删了 $j$ 条边的方案数

由于我们知道每删一次边就会形成两个联通块，也就是说我们知道了当前子树内的联通块个数为 $j+1$ (包括根节点所在的联通块)

先考虑从下往上转移，假设当前点为 $u$ ，对于一个子树 $v$，我们有两种选择

不切掉这条连接的边，那么由于一次可以同时删去很多条边，所以有

$$f_{u,j}\leftarrow \sum_{k+l\ge j}T(j,k,l) \times f_{u,k}f_{v,l}$$
其中 $T(j,k,l)$ 表示总共有 $j$ 个格子，选 $k$ 个涂蓝色，选 $l$ 个涂红色，问不能有白色的方案数


切掉这条连接的边，也是同理

$$f_{u,j}\leftarrow \sum_{k+l\ge j}T(j,k,l-1) \times f_{u,k}f_{v,l-1}$$
长得好像...卷积

接下来还要考虑从上往下的转移，其实就相当于强行剪掉这条边

那么暴力转移，前后缀优化一下





## T2

考虑这么一件事情

首先我们记 $f_{i,j,k}$ 表示当前添加到第 $i$ 个元素，上一段染色段是 $[j,k]$ 的最小代价

假设有 $x_i-d<j$ 那么会发生什么？

此时


不妨先考虑如果我们知道了最终序列，我们该怎么做

首先当有 $b(r-l)>2a$ 时，此时是一定没有直接新建右端点优的

所以对于两个点 $A,B$ ，若有 $x_B-x_A>\frac{2a}{b}=k$ ，则在点 $B$ 处新建一个端点

这也就提示我们，最终答案序列中不在同一联通块的点，他们的距离一定大于 $k$ 


![[sol(1).pdf]]


考虑转化


首先将那个 “每次至少选择一个点” 的限制通过二项式反演删掉，这样就变成了 “每次可以不选点，问选择 $k$ 次后正好删完” 的方案数

具体的，我们设每次至少选一个点的方案数为 $ans(i)$，每次可以不选点的方案数为 $ans'(i)$  ，那么此时有

$$ans'(k)=\sum_{i=0}^{k}C_{k}^{i}ans(k) \Rightarrow ans(i)=\sum_{i=0}^{k}(-1)^{k-i}C_{k}^{i}ans'(i)$$

这样子我们就可以考虑对整棵树进行染色，用一个颜色 $k$ 表示的当前点被删掉的时间，我们此时就需要满足所有同颜色的点构成一个联通块，或者说，对于所有的 $T\in[1,k]$ ，使得颜色 $\ge T$ 的点都形成一个联通块

考虑 dp ，用 $f_{i,j}$ 表示当前在点 $i$ ，点 $i$ 的颜色为 $j$ 且子树中所有点的颜色都小于等于 $j$ 的方案数

考虑转移，那么有

$$f_{u,j}=\prod_{v\in son_u} \sum_{k\le j}f_{v,k}$$
然后换根即可